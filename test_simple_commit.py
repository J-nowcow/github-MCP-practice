#!/usr/bin/env python3
"""
MCP ì„œë²„ì˜ ë„êµ¬ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì—¬ GitHubì— ì»¤ë°‹í•˜ëŠ” ê°„ë‹¨í•œ ìŠ¤í¬ë¦½íŠ¸
"""

import asyncio
import os
from dotenv import load_dotenv

# í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
load_dotenv()

# MCP ë„êµ¬ë“¤ ì§ì ‘ import
from mcp_github.tools_write import create_or_update_file


async def commit_via_mcp():
    """MCP ì„œë²„ë¡œ GitHubì— ì»¤ë°‹"""
    
    owner = "J-nowcow"
    repo = "github-MCP-practice"
    
    print(f"ğŸš€ MCP ì„œë²„ë¡œ GitHub ì»¤ë°‹ ì§„í–‰")
    print(f"ğŸ“ ì €ì¥ì†Œ: {owner}/{repo}")
    print("=" * 50)
    
    # ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
    file_path = "mcp_test/mcp_commit_test.md"
    content = """# MCP ì„œë²„ í…ŒìŠ¤íŠ¸ ğŸ¯

ì´ íŒŒì¼ì€ **ì§ì ‘ ë§Œë“  MCP ì„œë²„**ë¥¼ í†µí•´ GitHubì— ì»¤ë°‹ë˜ì—ˆìŠµë‹ˆë‹¤!

## MCP ì„œë²„ ê¸°ëŠ¥:
- âœ… íŒŒì¼ ìƒì„±/ìˆ˜ì •
- âœ… íŒŒì¼ ì‚­ì œ  
- âœ… ë¸Œëœì¹˜ ìƒì„±
- âœ… ì»¤ë°‹ ìƒì„±
- âœ… ì €ì¥ì†Œ ìƒíƒœ ì¡°íšŒ

## ì„±ê³µ! ğŸ‰
MCP ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---
*Generated by Custom MCP Server*
"""
    
    print(f"ğŸ“ íŒŒì¼ ìƒì„± ì¤‘: {file_path}")
    
    try:
        result = await create_or_update_file(
            owner=owner,
            repo=repo,
            path=file_path,
            content=content,
            message="ğŸ‰ MCP ì„œë²„ë¡œ ì§ì ‘ ì»¤ë°‹ ì„±ê³µ!",
            branch="main"
        )
        
        if result["success"]:
            print("âœ… ì»¤ë°‹ ì„±ê³µ!")
            print(f"   ğŸ“ íŒŒì¼: {result['data']['path']}")
            print(f"   ğŸ†” ì»¤ë°‹ SHA: {result['data']['commit_sha'][:8]}")
            print(f"   ğŸ”— URL: {result['data']['url']}")
            print(f"   ğŸŒ¿ ë¸Œëœì¹˜: {result['data']['branch']}")
        else:
            print(f"âŒ ì»¤ë°‹ ì‹¤íŒ¨: {result['error']}")
            print(f"   ğŸ“‹ ì „ì²´ ê²°ê³¼: {result}")
            
    except Exception as e:
        print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    # GitHub í† í° í™•ì¸
    if not os.getenv("GITHUB_TOKEN"):
        print("âŒ GITHUB_TOKEN í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        sys.exit(1)
    
    # ë¹„ë™ê¸° ì‹¤í–‰
    asyncio.run(commit_via_mcp())
